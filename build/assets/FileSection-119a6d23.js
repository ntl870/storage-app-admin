import{K as G,u as M,r as w,aa as $,ab as j,j as D,F as f,a as e,B as N,ac as Q,T,n as P,p as x,o as O,ad as q,P as K,ae as V,N as W,O as H,W as J,af as X,i as Y,ag as Z,ah as _,ai as aa,aj as ea,R as na,D as ta,C as oa,m as ia,l as sa,a5 as ra,ak as la,al as A,am as ca,an as ha}from"./index-18d7895e.js";import{F as ma,a as ua}from"./FileCard-f728ac1b.js";import{S as E,L as y,F as da}from"./index-5b4eb152.js";import{M as U}from"./index-8250cea1.js";import{L as Da,a as Ia,b as L,U as B,R,A as ya,C as ga}from"./FolderSection-8fc5df3c.js";import{m as va}from"./index-aa80ddb7.js";import{a as pa,c as wa}from"./index.es-f03b9607.js";import{D as ba}from"./DeleteOutlined-725f5558.js";const ka=({file:t,handleClose:c,open:h})=>{const{ID:u}=G(),{showErrorNotification:v,showSuccessNotification:b}=M(),[m,s]=w.useState(null),[n,g]=w.useState("Private"),[d,{loading:k}]=$(),{data:i,refetch:I,loading:C}=j({variables:{fileID:(t==null?void 0:t.ID)||""},skip:!(t!=null&&t.ID),onCompleted:a=>{g(a.getPeopleWithAccessToFile.isPublic?"Public":"Private")},fetchPolicy:"cache-and-network"}),S=async a=>{if(g(a),a==="Private")try{await d({variables:{fileID:(t==null?void 0:t.ID)||"",isPublic:!1}}),b("File access changed to private"),g("Private"),I()}catch(F){v(F.message)}if(a==="Public")try{await d({variables:{fileID:(t==null?void 0:t.ID)||"",isPublic:!0}}),b("File access changed to public"),g("Public"),I()}catch(F){v(F.message)}},p=w.useMemo(()=>u===(i==null?void 0:i.getPeopleWithAccessToFile.owner.ID)||(i==null?void 0:i.getPeopleWithAccessToFile.sharedUsers.some(a=>String(a.ID)===u)),[i,u]);return D(f,{children:[e(U,{okButtonProps:{hidden:!0},centered:!0,open:h,onCancel:c,title:"Share file",cancelText:"Close",footer:D(f,{children:[e(N,{icon:e(Da,{}),onClick:()=>{navigator.clipboard.writeText(`${window.location.origin}/file/${t==null?void 0:t.ID}`),va.success("Link copied to clipboard")},children:"Copy link"},"copy"),e(N,{type:"primary",onClick:c,children:"Done"},"done")]}),children:C||k?e("div",{className:"text-center",children:e(E,{})}):D(f,{children:[p&&e(Ia,{query:Q,format:a=>({label:`${a.name} - ${a.email}`,value:a.ID}),onChange:s}),D("div",{className:"mt-4",children:[e(T.Text,{className:"font-bold",children:"Users can modify"}),(()=>{const a=i==null?void 0:i.getPeopleWithAccessToFile.owner;return e(y,{children:D(y.Item,{children:[e(y.Item.Meta,{avatar:e(P,{size:"large",src:a!=null&&a.avatar?O(a.avatar):x(String(a==null?void 0:a.ID))}),title:a==null?void 0:a.name,description:a==null?void 0:a.email}),e(T.Text,{italic:!0,type:"secondary",className:"text-lg",children:"Owner"})]})})})(),e(y,{itemLayout:"horizontal",className:"max-h-96 overflow-y-auto",dataSource:i==null?void 0:i.getPeopleWithAccessToFile.sharedUsers.filter(a=>a.ID!==i.getPeopleWithAccessToFile.owner.ID),locale:{emptyText:" "},renderItem:a=>D(y.Item,{children:[e(y.Item.Meta,{avatar:e(P,{size:"large",src:a!=null&&a.avatar?O(a.avatar):x(String(a==null?void 0:a.ID))}),title:a==null?void 0:a.name,description:a==null?void 0:a.email}),p&&e(L,{initialRole:B.EDITOR,userID:(a==null?void 0:a.ID)||"",ID:(t==null?void 0:t.ID)||"",type:"file",refetchAccessPeople:I})]})})]}),D("div",{children:[e(T.Text,{className:"font-bold",children:"Users can view"}),e(y,{itemLayout:"horizontal",className:"max-h-96 overflow-y-auto",dataSource:i==null?void 0:i.getPeopleWithAccessToFile.readonlyUsers,renderItem:a=>D(y.Item,{children:[e(y.Item.Meta,{avatar:e(P,{size:"large",src:a.avatar?O(a.avatar):x(String(a.ID))}),title:a.name,description:a.email}),p&&e(L,{initialRole:B.VIEWER,userID:a.ID,ID:(t==null?void 0:t.ID)||"",type:"file",refetchAccessPeople:I})]})})]}),D("div",{className:"flex flex-col",children:[e(T.Text,{className:"font-bold",children:"General Access"}),D(R.Group,{onChange:a=>S(a.target.value),value:n,buttonStyle:"solid",disabled:!p,children:[e(R.Button,{value:"Public",className:"w-1/2 text-center",children:"Public"}),e(R.Button,{value:"Private",className:"w-1/2 text-center",children:"Private"})]})]})]})}),!!m&&e(ya,{type:"file",open:!!m,initialUser:m,handleClose:()=>s(null),ID:(t==null?void 0:t.ID)||"",refetchAccessPeople:I})]})},Ca=({open:t,selectedFile:c,refetch:h,handleClose:u})=>{const{showErrorNotification:v,showSuccessNotification:b}=M(),[m,s]=w.useState((c==null?void 0:c.name.split(".")[0])||""),[n]=q();return e(U,{open:t,title:"Rename File",onOk:async()=>{try{if(c!=null&&c.ID){const{data:d}=await n({variables:{fileID:c==null?void 0:c.ID,newName:m}});b((d==null?void 0:d.renameFile)||""),h(),u()}}catch(d){v(d.message)}},onCancel:u,children:e(K,{value:m,onChange:d=>s(d.target.value)})})},Sa=({open:t,movingFileID:c,handleClose:h,refetch:u})=>{const{showErrorNotification:v,showSuccessNotification:b}=M(),{rootFolderID:m,rootFolder:s}=G(),[n,g]=w.useState(s),[d]=V(),{data:k,loading:i}=W({variables:{folderID:(n==null?void 0:n.ID)||m||""},skip:!(n!=null&&n.ID)&&!m,fetchPolicy:"cache-and-network"}),{data:I,loading:C}=H({variables:{folderID:(n==null?void 0:n.ID)||m||""},skip:!(n!=null&&n.ID)&&!m,fetchPolicy:"cache-and-network"}),S=()=>{(n==null?void 0:n.ID)!==(s==null?void 0:s.ID)&&g(n==null?void 0:n.rootFolder)};return e(U,{open:t,onOk:async()=>{try{const{data:l}=await d({variables:{fileID:c,targetFolderID:(n==null?void 0:n.ID)||""}});b((l==null?void 0:l.moveFileToNewFolder)||""),h(),u()}catch(l){v(l.message)}},onCancel:h,closable:!1,okText:"Move",title:D("div",{children:[(n==null?void 0:n.ID)!==(s==null?void 0:s.ID)&&e(N,{icon:e(J,{}),shape:"circle",className:"mr-4",onClick:S}),(n==null?void 0:n.ID)===(s==null?void 0:s.ID)?"My Storage":n==null?void 0:n.name]}),children:i||C?e("div",{className:"h-[40rem] flex justify-center items-center",children:e(E,{size:"large"})}):e(y,{className:"max-h-[40rem] overflow-auto",itemLayout:"horizontal",dataSource:[...(k==null?void 0:k.getFoldersOfFolder)??[],...(I==null?void 0:I.getFilesByFolder)??[]],renderItem:l=>e(y.Item,{children:D(N,{type:"text",className:"w-full text-left",disabled:!!(l!=null&&l.fileType),onClick:()=>g(l),children:[l!=null&&l.fileType?e(X,{}):e(da,{}),l.name]})})})})},Ra=({files:t,handleClickItem:c,selectedItem:h,refetch:u,isStarred:v})=>{const{navigate:b}=Y(),{showSuccessNotification:m,showErrorNotification:s}=M(),[n]=Z(),[g]=_(),[d]=aa(),[k]=ea(),[i,I]=w.useState(null),[C,S]=w.useState(null),[p,l]=w.useState(null),a=()=>{b(`/file/${h==null?void 0:h.ID}`)},F=r=>[{label:"Download",key:"1",icon:e(ga,{}),onClick:()=>{ra(String(r.ID),"files",r.name)}},...v?[]:[{label:"Move to trash",key:"2",icon:e(ba,{}),onClick:async()=>{try{await n({variables:{fileID:r.ID}}),await u(),m("File moved to trash")}catch(o){s(o.message)}}},{label:"Share this file",key:"3",icon:e(la,{}),onClick:()=>{I(r)}},{label:"Star this file",key:"4",icon:e(A,{}),onClick:async()=>{try{const{data:o}=await g({variables:{fileID:r.ID}});o!=null&&o.starFile&&(await u(),m(o==null?void 0:o.starFile))}catch(o){s(o.message)}}},{label:"Rename",key:"5",icon:e(ca,{}),onClick:()=>{S(r)}},{label:"Make a Copy",key:"6",icon:e(ha,{}),onClick:async()=>{try{const{data:o}=await k({variables:{fileID:r.ID}});o!=null&&o.makeCopyOfFile&&(await u(),m(o==null?void 0:o.makeCopyOfFile))}catch(o){s(o.message)}}},{label:"Move to",key:"7",icon:e(pa,{icon:wa}),onClick:()=>{l(r)}}],...v?[{label:"Un-star this file",key:"4",icon:e(A,{}),onClick:async()=>{try{const{data:o}=await d({variables:{fileID:r.ID}});o!=null&&o.unstarFile&&(await u(),m(o==null?void 0:o.unstarFile))}catch(o){s(o.message)}}}]:[]],z=w.useMemo(()=>t.filter(r=>!r.isTrash),[t]);return D(f,{children:[e(na,{className:"ml-7",children:z.map(r=>e(ta,{menu:{items:F(r)},trigger:["contextMenu"],children:e(oa,{className:"m-4",children:e(ia,{title:r.name,children:e(ma,{cover:sa(r),className:"w-[17rem]",onClick:()=>{h&&r.ID===h.ID?a():c(r)},children:e(ua,{className:`${(h==null?void 0:h.ID)===r.ID&&h.type==="file"?"bg-blue-100":""}`,children:e(T.Text,{className:"w-full font-semibold pointer-events-none truncate inline-block select-none",children:r.name})})})})})},r.ID))}),!!i&&e(ka,{file:i,open:!!i,handleClose:()=>I(null)}),!!C&&e(Ca,{open:!!C,selectedFile:C,refetch:u,handleClose:()=>S(null)}),!!p&&e(Sa,{open:!!p,movingFileID:p.ID,handleClose:()=>l(null),refetch:u})]})};export{Ra as F,ka as S};
